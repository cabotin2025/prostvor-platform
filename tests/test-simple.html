<!DOCTYPE html>
<html>
<head>
    <title>–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç API</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { padding: 10px; margin: 5px; }
        input { padding: 8px; margin: 5px; width: 200px; }
        #output { margin-top: 20px; padding: 10px; border: 1px solid #ccc; min-height: 100px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç API Prostvor Platform</h1>
    
    <div>
        <h2>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h2>
        <button onclick="testConnection()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å API —Å–µ—Ä–≤–µ—Ä</button>
    </div>
    
    <div>
        <h2>2. –¢–µ—Å—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</h2>
        <input type="email" id="email" placeholder="Email" value="admin@example.com">
        <input type="password" id="password" placeholder="Password" value="admin123">
        <button onclick="testLogin()">–í–æ–π—Ç–∏</button>
        <button onclick="testLogout()">–í—ã–π—Ç–∏</button>
    </div>
    
    <div>
        <h2>3. –¢–µ—Å—Ç –¥–∞–Ω–Ω—ã—Ö (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é)</h2>
        <button onclick="testProjects()">–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–µ–∫—Ç—ã</button>
        <button onclick="testActors()">–ü–æ–ª—É—á–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</button>
    </div>
    
    <div>
        <h2>–°—Ç–∞—Ç—É—Å:</h2>
        <div id="status">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
    
    <div>
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h2>
        <div id="output"></div>
    </div>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º API —Å–µ—Ä–≤–∏—Å -->
    <script src="/js/api-service.js"></script>
    
    <script>
        function log(message, isError = false) {
            const output = document.getElementById('output');
            const div = document.createElement('div');
            div.className = isError ? 'error' : 'success';
            div.textContent = new Date().toLocaleTimeString() + ': ' + message;
            output.appendChild(div);
            console.log(message);
        }
        
        function updateStatus() {
            const statusEl = document.getElementById('status');
            if (window.api && window.api.isAuthenticated()) {
                statusEl.innerHTML = '‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∫–∞–∫: ' + (window.api.user.nickname || window.api.user.email);
                statusEl.style.color = 'green';
            } else {
                statusEl.innerHTML = '‚ùå –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
                statusEl.style.color = 'red';
            }
        }
        
        async function testConnection() {
            log('–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ API —Å–µ—Ä–≤–µ—Ä—É...');
            try {
                const result = await window.api.testConnection();
                if (result.success) {
                    log(`‚úÖ API —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç: ${result.data.app} v${result.data.version}`);
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞: ${result.error}`, true);
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, true);
            }
        }
        
        async function testLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            log(`–ü—ã—Ç–∞–µ–º—Å—è –≤–æ–π—Ç–∏ –∫–∞–∫ ${email}...`);
            
            try {
                const result = await window.api.login(email, password);
                if (result.success) {
                    log(`‚úÖ –í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${result.user.nickname}`);
                    updateStatus();
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ${result.error}`, true);
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, true);
            }
        }
        
        function testLogout() {
            log('–í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã...');
            window.api.logout();
            updateStatus();
            log('‚úÖ –í—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
        }
        
        async function testProjects() {
            if (!window.api.isAuthenticated()) {
                log('‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è!', true);
                return;
            }
            
            log('–ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–µ–∫—Ç—ã...');
            
            try {
                const result = await window.api.getProjects();
                if (result.success) {
                    log(`‚úÖ –ü–æ–ª—É—á–µ–Ω–æ –ø—Ä–æ–µ–∫—Ç–æ–≤: ${result.count}`);
                    
                    if (result.projects && result.projects.length > 0) {
                        result.projects.slice(0, 3).forEach(project => {
                            log(`   üìÅ ${project.title} (${project.project_status})`);
                        });
                        if (result.projects.length > 3) {
                            log(`   ... –∏ –µ—â–µ ${result.projects.length - 3} –ø—Ä–æ–µ–∫—Ç–æ–≤`);
                        }
                    } else {
                        log('‚ÑπÔ∏è –ü—Ä–æ–µ–∫—Ç–æ–≤ –Ω–µ—Ç');
                    }
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞: ${result.error}`, true);
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, true);
            }
        }
        
        async function testActors() {
            if (!window.api.isAuthenticated()) {
                log('‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è!', true);
                return;
            }
            
            log('–ó–∞–≥—Ä—É–∂–∞–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤...');
            
            try {
                const result = await window.api.getActors();
                if (result.success) {
                    log(`‚úÖ –ü–æ–ª—É—á–µ–Ω–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ${result.count}`);
                    
                    if (result.actors && result.actors.length > 0) {
                        result.actors.slice(0, 3).forEach(actor => {
                            log(`   üë§ ${actor.nickname} (${actor.email || '–±–µ–∑ email'})`);
                        });
                        if (result.actors.length > 3) {
                            log(`   ... –∏ –µ—â–µ ${result.actors.length - 3} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤`);
                        }
                    }
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞: ${result.error}`, true);
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, true);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            updateStatus();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
            setTimeout(testConnection, 500);
        });
    </script>
</body>
</html>